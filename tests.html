<html>
  <head>
    <title>Rummi tests</title>
    <style type='text/css'>
      span.tilecolour-R { background: red; color: white }
      span.tilecolour-T { background: aqua; color: black }
      span.tilecolour-Y { background: orange; color: black }
      span.tilecolour-B { background: black; color: white }
      #solution li {
	  margin: 1ex;
	  border: 1px solid black;
	  padding: 2ex 2ex 2ex 1ex;
	  list-style: none;
	  width: fit-content;
	  background: #e0e0e0;
	  display: inline-block;
      }
      li > span { margin-left: 1ex; padding: 4px; width: 4ex; display: inline-block; text-align: center }
      li > span.joker { font-weight: bold }
      #tosolve span { margin-left: 1ex; padding: 4px }
      #tosolve span.joker { font-weight: bold }
      #tosolve { margin: 1ex; line-height: 2em; }
    </style>
    <script src='./rummi.js'></script>
    <script>

      
      function clear() {
	  for (let l of ['errors', 'output']) {
	      const e = document.getElementById(l);
	      while (e.firstChild) e.removeChild(e.firstChild);
	  }
      }
      function err(x) {
	  const li = document.createElement('li');
	  li.textContent = x;
	  document.getElementById('errors').appendChild(li);
      }
      function out(x) {
	  const li = document.createElement('li');
	  li.textContent = x;
	  document.getElementById('output').appendChild(li);
      }
      function go() {
	  const selected = document.getElementById('onetest').value;
	  if (selected) return runonetest(selected);
	  const results = runtests();
	  console.log(results);
	  for (let e of results.failed) err(e);
	  for (let o of results.all) out(o);
      }

      function dosolve() {
	let arr = tocards(document.getElementById('hand').value),
	    li = document.querySelector('#tosolve'),
	    display = document.getElementById('solution');
	arr.sort((x, y) => (x - y));
	while (li.firstChild) li.removeChild(li.firstChild);
	arr.map(c => prettytile(c, document)).forEach(el => {
	  li.appendChild(el);
	  li.append(document.createTextNode(' '));
	});
	while (display.firstChild) display.removeChild(display.firstChild);
	document.getElementById('solvestatus').textContent = 'Working...';
	workersolve(arr);
      }

      function get_worker() {
	if (!window.solve_worker) solve_worker = new Worker('./worker.js');
	return solve_worker;
      }

      function workersolve(tiles) {
	get_worker();
	let starttm = new Date().getTime();

	solve_worker.onmessage = (msg) => {
	  console.log('solve:', msg.data);
	  if (msg.data.completed)
	    solve_complete(tiles, starttm, msg.data);
	  else {
	    const seconds = (new Date().getTime() - msg.data.start_time)/1000;
	    document.getElementById('solvestatus').textContent = 'Working ' + Math.floor(seconds) + 's';
	  }
	}
	solve_worker.postMessage(tiles);
	console.log('waiting for solve');
      }

      function random_hands(cases, bag_size) {
	get_worker();
	solve_worker.onmessage = (msg) => {
	  console.log(msg.data);
	  lastmsg = msg.data;
	}
	solve_worker.postMessage({test_vector: {cases: cases, bag_size: bag_size}});
      }
    </script>
  </head>
  <body>
    <div>
      <p>Colours: R T Y B / Ranks: 1 - 13 / Jokers: JS JD JM JC</p>
    </div>
    <input id='hand' width='80'></input>
    <button onclick='dosolve()'>Solve</button>
    <div id='tosolve'></div>
    <p id='solvestatus'></p>
    <ul id='solution'></ul>
    <hr/>
    <input id='onetest'></input> <button onclick='go()'>test</button>
    <ol id='errors'></ol>
    <ol id='output'></ol>
  </body>
</html>

  
